# Leaflow è‡ªåŠ¨ç­¾åˆ°è„šæœ¬

![Python](https://img.shields.io/badge/Python-3.7%2B-blue)
![License](https://img.shields.io/badge/License-MIT-green)

* TGäº¤æµåé¦ˆç¾¤ç»„ï¼šhttps://t.me/eooceu
* youtubeè§†é¢‘æ•™ç¨‹ï¼šhttps://www.youtube.com/@eooce


Leaflow å¤šè´¦å·è‡ªåŠ¨ç­¾åˆ°è„šæœ¬ï¼Œæ”¯æŒ Telegram é€šçŸ¥å’Œ GitHub Actions è‡ªåŠ¨åŒ–è¿è¡Œã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… æ”¯æŒå¤šä¸ª Leaflow è´¦å·è‡ªåŠ¨ç­¾åˆ°
- ğŸ¤– åŸºäº Selenium å®ç°è‡ªåŠ¨åŒ–æ“ä½œ
- ğŸ“± è‡ªåŠ¨å¤„ç†ç½‘ç«™å¼¹çª—å’ŒéªŒè¯ç 
- ğŸ“¢ æ”¯æŒ Telegram é€šçŸ¥æ¨é€
- â° æ”¯æŒ GitHub Actions å®šæ—¶è‡ªåŠ¨æ‰§è¡Œ
- ğŸ”„ æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼Œæé«˜ç­¾åˆ°æˆåŠŸç‡
- ğŸ“Š è¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†

## ä½¿ç”¨æ–¹æ³•

### æ³¨å†ŒLeaflowè´¦å·ï¼šhttps://leaflow.net/login

### é¦–æ¬¡è¯·åœ¨æ§åˆ¶å°ç­¾åˆ°é¡µé¢æˆæƒï¼Œå¦åˆ™ç­¾åˆ°å¤±è´¥

#### é…ç½®è´¦å·ä¿¡æ¯

è„šæœ¬æ”¯æŒä¸¤ç§ç§æ–¹å¼é…ç½®è´¦å·ä¿¡æ¯ï¼š

##### æ–¹å¼ä¸€ï¼šå•ä¸ªè´¦å·
```bash
LEAFLOW_EMAIL    your_email@example.com
LEAFLOW_PASSWORD    your_password
```

##### æ–¹å¼äºŒï¼šå¤šä¸ªè´¦å·ï¼ˆåˆ†éš”ç¬¦æ–¹å¼ï¼Œå‘åå…¼å®¹ï¼‰
```bash
å˜é‡åï¼šLEAFLOW_ACCOUNTS
å˜é‡å€¼ï¼šé‚®ç®±1:å¯†ç 1,é‚®ç®±2:å¯†ç 2,é‚®ç®±3:å¯†ç 3
```


### GitHub Actions è‡ªåŠ¨è¿è¡Œ

1. Fork æœ¬ä»“åº“
2. åœ¨ä»“åº“ Settings > Secrets and variables > Actions ä¸­æ·»åŠ ä»¥ä¸‹ secretsï¼š
   - `LEAFLOW_ACCOUNTS`: è´¦å·ä¿¡æ¯(è´¦å·å¯†ç ä¹‹é—´è‹±æ–‡å†’å·åˆ†éš”,å¤šè´¦å·ä¹‹é—´è‹±æ–‡é€—å·åˆ†éš”)

Telegram é€šçŸ¥é…ç½®ï¼ˆå¯é€‰ï¼Œä¸éœ€è¦tgé€šçŸ¥å¯ä¸å¡«ï¼‰
   - `TELEGRAM_BOT_TOKEN`   Telegram Bot Tokenï¼Œhttps://t.me/BotFather åˆ›å»ºæœºå™¨äºº
   - `TELEGRAM_CHAT_ID`     Telegram Chat IDï¼Œhttps://t.me/laowang_serv00_bot å‘é€ /start è·å–

3. å¯ç”¨ Actions å¯ç”¨å·¥ä½œæµ

## é…ç½®è¯´æ˜

| ç¯å¢ƒå˜é‡ | å¿…éœ€ | è¯´æ˜ |
|---------|------|------|
| `LEAFLOW_EMAIL` | å¦* | å•ä¸ªè´¦å·é‚®ç®±ï¼ˆæ–¹å¼ä¸€ï¼‰ |
| `LEAFLOW_PASSWORD` | å¦* | å•ä¸ªè´¦å·å¯†ç ï¼ˆæ–¹å¼ä¸€ï¼‰ |
| `LEAFLOW_ACCOUNTS` | å¦* | å¤šä¸ªè´¦å·å¯†ç ï¼Œé€—å·åˆ†éš”ï¼ˆæ–¹å¼äºŒ,æ¨èï¼‰ |
| `TELEGRAM_BOT_TOKEN` | å¦ | Telegram Bot Token |
| `TELEGRAM_CHAT_ID` | å¦ | Telegram Chat ID |

*æ³¨ï¼šä»¥ä¸Šè´¦å·é…ç½®æ–¹å¼è‡³å°‘éœ€è¦é…ç½®ä¸€ç§


## æ³¨æ„äº‹é¡¹
- è¯·ç¡®ä¿åœ¨ç­¾åˆ°é¡µé¢å·²æˆæƒ
- è¯·ç¡®ä¿è´¦å·ä¿¡æ¯æ­£ç¡®æ— è¯¯,å¹¶æ­£ç¡®é…ç½®secrets
- è„šæœ¬ä¼šåœ¨è´¦å·é—´é—´éš” 10 ç§’é’Ÿï¼Œé¿å…è¯·æ±‚è¿‡äºé¢‘ç¹
- åœ¨ GitHub Actions ä¸­è¿è¡Œæ—¶ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨ä½¿ç”¨æ— å¤´æ¨¡å¼ï¼ˆheadless modeï¼‰
- è¯·éµå®ˆç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾ï¼Œåˆç†ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬

## Alpine VPS å®¹å™¨ï¼ˆTUIC + Hysteria2ï¼‰

ä¸ºæ–¹ä¾¿åœ¨è½»é‡çº§ç¯å¢ƒä¸­éƒ¨ç½² TUIC ä¸ Hysteria2 ä»£ç†ï¼Œä»“åº“æ–°å¢äº†åŸºäºæœ€æ–° Alpine Linux çš„å®¹å™¨åŒ–æ–¹æ¡ˆã€‚

### æ„å»ºé•œåƒ

```bash
# ç›´æ¥æ„å»ºï¼ˆé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ tuic-server ä¸ hysteria äºŒè¿›åˆ¶ï¼‰
docker build -t leaflow/alpine-vps .

# æˆ–é€šè¿‡ docker compose
docker compose build
```

å¯é€šè¿‡æ„å»ºå‚æ•°è‡ªå®šä¹‰ç‰ˆæœ¬æˆ–è·³è¿‡æ„å»ºæ—¶çš„è‡ªåŠ¨å®‰è£…ï¼š

```bash
docker build \
  --build-arg TUIC_VERSION=tuic-server-1.0.0 \
  --build-arg HY2_VERSION=app/v2.6.4 \
  --build-arg INSTALL_AT_BUILD=false \
  -t leaflow/alpine-vps .
```

### è¿è¡Œå®¹å™¨

ä½¿ç”¨ docker compose ç¤ºä¾‹ï¼š

```bash
mkdir -p data/tuic data/hysteria data/runtime
docker compose up -d
```

é»˜è®¤æš´éœ²ç«¯å£ï¼š

- `443/udp`ï¼šTUIC QUIC æœåŠ¡ç«¯å£
- `8443/udp`ï¼šHysteria2 æ¨èç›‘å¬ç«¯å£
- `1080/tcp`ï¼šå¯ç”¨äºæœ¬åœ°è°ƒè¯•æˆ– SOCKS/HTTP ä»£ç†

å¦‚éœ€è‡ªå®šä¹‰ç«¯å£æˆ–åè®®ï¼Œè¯·åœ¨ `docker-compose.yml` ä¸­è°ƒæ•´ `ports` é…ç½®ã€‚

å®¹å™¨ä¼šè‡ªåŠ¨æŒ‚è½½ä¸‹åˆ—æŒä¹…åŒ–ç›®å½•ï¼š

- `./data/tuic -> /etc/tuic`
- `./data/hysteria -> /etc/hysteria`
- `./data/runtime -> /srv/proxy`

å¦‚éœ€åœ¨å®¹å™¨å†…éƒ¨ä»¥é root ç”¨æˆ·è¿è¡Œä»£ç†ï¼Œå¯åœ¨ `docker-compose.yml` ä¸­è¿½åŠ  `user: proxy`ï¼Œæˆ–åœ¨è‡ªå®šä¹‰å…¥å£è„šæœ¬ä¸­ä½¿ç”¨ `su - proxy` åˆ‡æ¢ç”¨æˆ·ï¼›è‹¥éœ€è¦é…ç½® iptables æˆ–ç®¡ç†ä½å·ç«¯å£ï¼Œåˆ™ä¿æŒé»˜è®¤çš„ root æƒé™ã€‚

> æç¤ºï¼šTUIC ä¸ Hysteria2 å‡éœ€è¦ UDP ç«¯å£å¯è¾¾ï¼Œä¸ºä¿è¯æ­£å¸¸å·¥ä½œè¯·æ‰“å¼€å®¿ä¸»æœºå¯¹åº”çš„ UDP ç«¯å£å¹¶ä¿ç•™ `cap_add: [NET_ADMIN]` ä¸ `sysctls` è®¾ç½®ï¼ˆç”¨äºå®¹å™¨å†… iptables/IPv4 è½¬å‘ï¼‰ã€‚

### å®‰è£…è„šæœ¬

å®¹å™¨å†…ç½® `install-tuic-hy2`ï¼ˆä½äº `/usr/local/bin/install-tuic-hy2`ï¼‰ã€‚å¦‚æœéœ€è¦é‡æ–°å®‰è£…æˆ–æ›´æ¢ç‰ˆæœ¬ï¼Œå¯åœ¨å®¹å™¨å†…æ‰§è¡Œï¼š

```bash
install-tuic-hy2 --tuic-version tuic-server-1.0.0 --hy2-version app/v2.6.4
```

å¸¸ç”¨å‚æ•°ï¼š

- `--prefix`ï¼šæŒ‡å®šäºŒè¿›åˆ¶å®‰è£…è·¯å¾„ï¼ˆé»˜è®¤ `/usr/local/bin`ï¼‰
- `--config-root`ï¼šé…ç½®æ–‡ä»¶æ ¹ç›®å½•ï¼ˆé»˜è®¤ `/etc`ï¼‰
- `--keep-archive`ï¼šä¿ç•™ä¸‹è½½æ–‡ä»¶ï¼Œä¾¿äºç¦»çº¿åˆ†å‘

è„šæœ¬ä¼šæ ¹æ®å®¹å™¨æ¶æ„è‡ªåŠ¨åŒ¹é…å¯¹åº”çš„ musl æ„å»ºï¼Œå¹¶ç”Ÿæˆé…ç½®ç›®å½• `/etc/tuic` ä¸ `/etc/hysteria`ã€‚

### åŸºæœ¬é…ç½®ç¤ºä¾‹

TUIC (`/etc/tuic/server.json`)ï¼š

```json
{
  "server": {
    "certificate": "/etc/tuic/cert.pem",
    "private_key": "/etc/tuic/key.pem"
  },
  "users": {
    "user1": {
      "password": "replace-with-secure-password"
    }
  },
  "listen": "0.0.0.0:443",
  "congestion_control": "bbr"
}
```

Hysteria2 (`/etc/hysteria/config.yaml`)ï¼š

```yaml
listen: :8443
acme: false
cert: /etc/hysteria/cert.pem
key: /etc/hysteria/key.pem
auth:
  type: password
  password: replace-with-secure-password
transport:
  udp:
    hopInterval: 30s
```

å¯åŠ¨å‘½ä»¤ç¤ºä¾‹ï¼š

```bash
# TUIC server
tuic-server -c /etc/tuic/server.json

# Hysteria2 server
hysteria server --config /etc/hysteria/config.yaml
```

æ ¹æ®éœ€è¦å¯ç»“åˆ `supervisord`ã€`s6-overlay` æˆ– systemd-nspawn ç­‰è¿›ç¨‹ç®¡ç†å™¨è¿›ä¸€æ­¥è‡ªåŠ¨åŒ–ï¼Œä¹Ÿå¯ä»¥åœ¨ docker compose ä¸­é€šè¿‡ `command`/`entrypoint` æŒ‡å®šå¯åŠ¨è„šæœ¬ã€‚

## è®¸å¯è¯
GPL 3.0

## éƒ‘é‡å£°æ˜
* ç¦æ­¢æ–°å»ºé¡¹ç›®å°†ä»£ç å¤åˆ¶åˆ°è‡ªå·±ä»“åº“ä¸­ç”¨åšå•†ä¸šè¡Œä¸ºï¼Œè¿è€…å¿…ç©¶
* ç”¨äºå•†ä¸šè¡Œä¸ºçš„ä»»ä½•åˆ†æ”¯å¿…é¡»å®Œæ•´ä¿ç•™æœ¬é¡¹ç›®è¯´æ˜ï¼Œè¿è€…å¿…ç©¶
* è¯·éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„,ç¦æ­¢æ»¥ç”¨åšå…¬å…±ä»£ç†è¡Œä¸º
